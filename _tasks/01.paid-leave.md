# Chức năng nghỉ phép (paid leave) và nghỉ không lương (unpaid leave)

### Mô tả:

Nhân viên được phép tạo đơn nghỉ phép để đánh dấu ngày nghỉ của mình.
Nghỉ phép phải được phê duyệt bởi admin.
Nhân viên có thể chỉnh sửa đơn nghỉ phép nếu chưa được phê duyệt, nếu đã duyệt thì chỉ admin được phép chỉnh sửa.

Nhân viên mặc định có 12 ngày phép/năm. Nếu trong năm sử dụng hết số ngày phép thì không được tạo thêm đơn nghỉ phép (lưu ý không tính các ngày phép bị hủy).

Nghỉ không lương cũng có logic tương tự nhưng mỗi năm có 30 ngày nghỉ không lương


### Triển khai

#### 0. Chức năng yêu cầu

Xây dựng cụm chức năng **tạo đơn nghỉ cho nhân viên** với mô tả sau:

- Nhân viên có thể tạo đơn nghỉ phép/nghỉ không lương nếu đủ điều kiện (chưa dùng hết phép trong năm)
- Nhân viên có thể hủy hoặc thay đổi nội dung của đơn nếu chưa được duyệt
- Nhân viên có thể xem các đơn đã tạo và trạng thái của chúng (trang danh sách, chi tiết)

---> Có thể thêm cột để đáp ứng được mô tả chức năng (tạo file .sql trong thư mục `_database_convert`)

**Validation**

Một số ràng buộc phải có khi tạo/update đơn:

- Ngày bắt đầu (start_date) <= ngày kết thúc (end_date)
- Số ngày nghỉ (leave_days) được tính tự động khi tạo đơn, không bao gồm thứ 7 và chủ nhật
- Nếu loại đơn là nghỉ phép thì không bắt buộc nhập lý do, nghỉ không lương thì bắt buộc phải nhập lý do


#### 1. Tạo bảng `leave_requests` theo mô tả bên dưới

```SQL
CREATE TABLE leave_requests (
    id INT AUTO_INCREMENT PRIMARY KEY,
    employee_code VARCHAR(30) NOT NULL COMMENT 'Mã nhân viên tạo đơn nghỉ phép',
    leave_type ENUM('paid', 'unpaid') NOT NULL COMMENT 'Loại đơn: nghỉ phép/nghỉ không lương',
    start_date DATE NOT NULL COMMENT 'Thời gian nghỉ (ngày bắt đầu)',
    end_date DATE NOT NULL COMMENT 'Thời gian nghỉ (ngày kết thúc)',
    leave_days DECIMAL(4,2) NOT NULL COMMENT 'Số ngày nghỉ, dùng để thống kê, không tính thứ 7, chủ nhật',
    session ENUM('morning', 'afternoon', 'full_day') DEFAULT 'full_day' COMMENT 'Nghỉ sáng, chiều hay cả ngày',
    reason VARCHAR(500) COMMENT 'Lý do nghỉ',
    status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT 'Trạng thái của đơn',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'Ngày tạo đơn',
    approved_at DATETIME COMMENT 'Ngày phê duyệt',
    approver_id INT COMMENT 'Người phê duyệt', 
    
    FOREIGN KEY (employee_code) REFERENCES employees(employee_code)
)
```

#### 2. Chuyển bảng `leave_requests` thành Model trong Laravel

Dự án sử dụng `reliese/laravel` để tự động tạo model từ bảng có sẵn. Để tạo Model từ bảng `leave_requests` cần sử dụng lệnh sau:

```bash
php artisan code:models --table=leave_requests

```
